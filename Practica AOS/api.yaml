openapi: 3.0.0

info:
  title: Taller de Coches - Subsistema de Envío de Notificaciones
  version: 1.0.0
servers:
  - url: http://localhost:8080

paths:
  /notificaciones/correo:
    post:
      summary: Envío de notificación de cambio de estado del trabajo por correo
      description: Envía una notificación por correo al cliente cuando cambia el estado de un trabajo
      tags:
        - "Notificaciones 🔔"
      requestBody:
        $ref: '#/components/requestBodies/NotificacionRB'
      responses:
        '200':
          $ref: '#/components/responses/NotificacionResponse'
        '400':
          $ref: '#/components/responses/Response400'
  /notificaciones/telefono:
    post:
      summary: Envío de notificación de cambio de estado del trabajo por teléfono
      description: Envía una notificación por teléfono al cliente cuando cambia el estado de un trabajo
      tags:
        - "Notificaciones 🔔"
      requestBody:
        $ref: '#/components/requestBodies/NotificacionRB'
      responses:
        '200':
          $ref: '#/components/responses/NotificacionResponse'
        '400':
          $ref: '#/components/responses/Response400'
  /notificaciones/masivas:
    post:
      summary: Envío de notificación masiva
      description: Envía una notificación a todos los clientes con trabajos pendientes
      tags:
        - "Notificaciones"
      requestBody:
        $ref: '#/components/requestBodies/NotificacionMasivaRB'
      responses:
        '200':
          $ref: '#/components/responses/NotificacionMasivaResponse'
        '400':
          $ref: '#/components/responses/Response400'
  /notificaciones/{idNotificacion}:
    get:
      summary: Obtener una notificación
      description: Obtiene una notificación mediante su id, así como los enlaces a los recursos relacionados
      tags:
        - "Notificaciones 🔔"
      parameters:
        - name: idNotificacion
          in: path
          required: true
          description: Identificador único de la notificación
          schema:
            type: string
      responses:
        '200':
          description: Notificación obtenida correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Notificacion'
        '400':
          $ref: '#/components/responses/Response400'
        '404':
          $ref: '#/components/responses/Response404'
  /notificaciones/{idTrabajo}:
    get:
      summary: Obtener notificaciones de un trabajo
      description: Obtiene todas las notificaciones de un trabajo, así como los enlaces a los recursos relacionados
      tags:
        - "Notificaciones 🔔"
      parameters:
        - name: idTrabajo
          in: path
          required: true
          description: Identificador único del trabajo
          schema:
            type: string
      responses:
        '200':
          description: Notificaciones del trabajo obtenidas correctamente
          content:
            application/json:
              schema:
                type: array
                items: 
                  $ref: '#/components/schemas/Notificacion'
        '400':
          $ref: '#/components/responses/Response400'
        '404':
          $ref: '#/components/responses/Response404'
  /notificaciones/{idCliente}:
    get:
      summary: Obtener notificaciones de un cliente
      description: Obtiene todas las notificaciones de un cliente, así como los enlaces a los recursos relacionados
      tags:
        - "Notificaciones 🔔"
      parameters:
        - name: idCliente
          in: path
          required: true
          description: Identificador único del cliente
          schema:
            type: string
      responses:
        '200':
          description: Notificaciones del cliente obtenidas correctamente
          content:
            application/json:
              schema:
                type: array
                items: 
                  $ref: '#/components/schemas/Notificacion'
        '400':
          $ref: '#/components/responses/Response400'
        '404':
          $ref: '#/components/responses/Response404'
    patch:
      summary: Actualizar la suscripción a notificaciones
      description: Actualiza la suscripción a notificaciones de un cliente
      tags:
        - "Notificaciones 🔔"
      requestBody:
        $ref: '#/components/requestBodies/SuscripcionNotificacionesRB'
      responses:
        '200':
          description: Suscripción actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cliente'
        '400':
          $ref: '#/components/responses/Response400'
        '404':
          $ref: '#/components/responses/Response404'

components:
  schemas:
    Trabajo:
      type: object
      properties:
        idTrabajo:
          type: string
        estado:
          type: string
        descripcion:
          type: string
        fechaInicio:
          type: string
          format: date-time
        fechaFin:
          type: string
          format: date-time
        vehiculo:
          $ref: '#/components/schemas/Vehiculo'
        notificaciones:
          type: array
          items:
            $ref: '#/components/schemas/Notificacion'
      required:
          - idTrabajo
          - estado
          - descripcion
          - fechaInicio
          - vehiculo
    Notificacion:
      type: object
      properties:
        idNotificacion:
          type: string
        idTrabajo:
          type: string
        mensaje:
          type: string
        fechaEnvio:
          type: string
          format: date-time
        estado:
          type: string
        enlaces:
          type: array
          items:
            type: integer
      required:
        - idNotificacion
        - idTrabajo
        - mensaje
        - fechaEnvio
        - estado
      example:
        idNotificacion: "ij2409234h2"
        idTrabajo: "87da6d898d"
        mensaje: "El trabajo ha sido realizado"
        fechaEnvio: "2023-04-10T17:51:00Z"
        estado: "enviada"
        enlaces:
          - rel: "self"
            href: "https://ejemplo.com/api/v1/notificaciones/ij2409234h2"
          - rel: "trabajo"
            href: "https://ejemplo.com/api/v1/trabajos/87da6d898d"
    Vehiculo:
      type: object
      properties:
        vin:
          type: string
        marca:
          type: string
        modelo:
          type: string
        year:
          type: integer
        cliente:
          type: integer
      required:
        - vin
        - marca
        - modelo
        - year
        - cliente
      example:
        vin: "1HGCM82633A004352"
        marca: "Mercedes"
        modelo: "Clase A"
        year: 2023
        cliente:
          idCliente: "7y2f5g28974y"
          nombre: "Pepe"
          apellido: "Pérez"
          correo: "pepeperez@example.com"
          telefono: "689374623"
    Cliente:
      type: object
      properties:
        nombre: 
          type: string
        apellido: 
          type: string
        telefono: 
          type: string
        email: 
          type: string
        direccion: 
          type: string
        recibeNotificaciones:
          type: boolean
      required:
        - nombre
        - apellido
        - telefono
        - email
        - direccion
        - recibeNotificaciones
    NotificacionMasiva:
      type: object
      properties:
        idNotificacion:
          type: string
        mensaje:
          type: string
        fechaEnvio:
          type: string
          format: date-time
  requestBodies:
    NotificacionRB:
      description: Datos de la notificación a crear
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              idTrabajo:
                type: string
                description: ID del trabajo al que está relacionada la notificación
              mensaje:
                type: string
                description: Mensaje de la notificación
            required:
              - idTrabajo
              - mensaje
    NotificacionMasivaRB:
      description: Datos de una notificación masiva
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              mensaje:
                type: string
                description: Mensaje de la notificación
              fechaProgramada: 
                type: string
                format: date-time
            required:
              - mensaje
    SuscripcionNotificacionesRB:
      description: Datos de la suscripción a las notificaciones 
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              idCliente:
                type: string
                description: Id del cliente
              suscripcion:
                type: boolean
                description: indica si un usuario está suscrito a las notificaciones
  responses:
    NotificacionResponse:
      description: Notificación enviada correctamente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Notificacion'
    NotificacionMasivaResponse:
      description: Notificación masiva enviada correctamente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/NotificacionMasiva'
    Response400:
      description: "Bad Request"
    Response404:
      description: "`NOT FOUND`: resource not found"

    